(function(){const p=document.createElement("link").relList;if(p&&p.supports&&p.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))d(e);new MutationObserver(e=>{for(const s of e)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&d(i)}).observe(document,{childList:!0,subtree:!0});function b(e){const s={};return e.integrity&&(s.integrity=e.integrity),e.referrerPolicy&&(s.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?s.credentials="include":e.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function d(e){if(e.ep)return;e.ep=!0;const s=b(e);fetch(e.href,s)}})();function X(){sap.ui.require(["sap/m/App","sap/m/Page","sap/m/Input","sap/m/Button","sap/m/Title","sap/m/Table","sap/m/Column","sap/m/ColumnListItem","sap/m/Text","sap/ui/model/json/JSONModel","sap/m/Toolbar","sap/m/ToolbarSpacer","sap/ui/model/Sorter","sap/m/ViewSettingsDialog","sap/ui/model/Filter","sap/m/ViewSettingsFilterItem","sap/m/ViewSettingsItem","sap/m/VBox","sap/m/FormattedText","sap/m/ObjectNumber","sap/f/Avatar","sap/m/ObjectIdentifier"],function(v,p,b,d,e,s,i,O,t,j,k,x,U,V,F,Y,Z,ee,L,W,q,N){const I=new j({maternites:[],SourceCredit:"<p>Source des données: <cite>DREES – Ministère de la Santé – <a href='https://data.drees.solidarites-sante.gouv.fr' target='_blank'>https://data.drees.solidarites-sante.gouv.fr</a></cite></p>"}),P=new q({src:"https://nicolasjak.github.io/cassylprod/CassylMama.jpg",displaySize:"L",showBorder:!1,visible:!1,press:function(){window.location.href="https://cassylmama.com"}}),l=new b({placeholder:"Code postal",width:"100px"}),C=new sap.m.VBox({items:[new L({htmlText:I.getData().SourceCredit})]});function T(){var a=w.getBinding("items").getLength();sap.ui.getCore().byId("tableItemCount").setText("("+a+")")}const _="Un établissement est dit de type 1 s’il possède un service d’obstétrique, de type 2a s’il a aussi un service de néonatologie sur le même site que le service d’obstétrique, de type 2b s’il a aussi un service de soins intensifs néonatals et de type 3 s’il dispose, sur le même site que le service d’obstétrique, des trois services précédents (obstétrique, néonatologie et soins intensifs néonatals) ainsi que d’un service de réanimation néonatale.",H=new d({text:"Rechercher",width:"100px",press:async function(){await A()}});async function A(){var m;u.setVisible(!0);const a=l.getValue();if(a)try{let B=function(n){switch(n){case"1":return"Information";case"2a":return"Information";case"2b":return"Information";case"3":return"Information";default:return"Information"}};var f=B;u.setVisible(!0);const D=await(await fetch(`https://nominatim.openstreetmap.org/search?format=json&addressdetails=1&q=${encodeURIComponent(a)}`)).json();if(!D.length)throw new Error("Adresse introuvable");const g=(m=D[0].address)==null?void 0:m.postcode;let h="";g.startsWith("97")&&g.length>=3?h=g.slice(0,3):g.length>=2&&(h=g.slice(0,2));const J=(await(await fetch(`https://geo.api.gouv.fr/departements/${h}`)).json()).codeRegion,Q=(await(await fetch(`https://geo.api.gouv.fr/regions/${J}/departements`)).json()).map(n=>n.code),M=await(await fetch("/cassyl-maternites/fichier_maternites_112021.json")).json();M.sort((n,o)=>parseInt(o.annee)-parseInt(n.annee));const S={};for(const n of M)S[n.fi_et]||(S[n.fi_et]=n);const R=Object.values(S).filter(n=>{const o=n.cpo;if(!o||typeof o!="string")return!1;const y=o.startsWith("97")?o.slice(0,3):o.slice(0,2);return Q.includes(y)});R.sort((n,o)=>{const y=n.cpo.startsWith(h)?0:1,E=o.cpo.startsWith(h)?0:1;return y!==E?y-E:n.cpo.localeCompare(o.cpo)});const G=R.map(n=>({...n,typeState:B(n.type)}));I.setData({maternites:G}),T(),u.setVisible(!1)}catch(r){u.setVisible(!1),alert("Erreur lors de la recherche."),console.error(r)}}l.attachBrowserEvent("keydown",function(a){a.key==="Enter"&&A()});function K(a){sap.m.MessageToast.show(_,{duration:15e3,width:"60em",my:"center bottom",at:"center bottom",of:window,offset:"0 0",collision:"fit fit",onClose:null,autoClose:!0,animationTimingFunction:"ease",animationDuration:1e3,closeOnBrowserNavigation:!0})}var $=new t("tableItemCount",{text:" "});const u=new sap.m.BusyIndicator({visible:!1}),w=new s("maternitesTable",{sticky:["ColumnHeaders"],growing:!1,headerToolbar:new k({content:[new e({text:"Maternités dans votre région",level:"H2"}),$,new x,u,new x,new d({icon:"sap-icon://sort",tooltip:"Trier",press:function(){new V({sortItems:[new sap.m.ViewSettingsItem({text:"Lits Obs",key:"lit_obs"}),new sap.m.ViewSettingsItem({text:"Salle Travail",key:"saltrav"}),new sap.m.ViewSettingsItem({text:"Accouchements",key:"acctot"})],confirm:function(f){const m=f.getParameter("sortItem").getKey(),r=f.getParameter("sortDescending");w.getBinding("items").sort(new U(m,r))}}).open()}}),new d({icon:"sap-icon://filter",tooltip:"Filtrer",press:function(){new V({filterItems:[new sap.m.ViewSettingsFilterItem({text:"Statut",key:"statut",items:[new sap.m.ViewSettingsItem({text:"Public",key:"PUBLIC"}),new sap.m.ViewSettingsItem({text:"Privé non lucratif",key:"PRIVE NON LUCRATIF"}),new sap.m.ViewSettingsItem({text:"Privé",key:"PRIVE LUCRATIF"})]}),new sap.m.ViewSettingsFilterItem({text:"Type",key:"type",items:[new sap.m.ViewSettingsItem({text:"Type 1",key:"1"}),new sap.m.ViewSettingsItem({text:"Type 2A",key:"2a"}),new sap.m.ViewSettingsItem({text:"Type 2B",key:"2b"}),new sap.m.ViewSettingsItem({text:"Type 3",key:"3"})]})],confirm:function(f){const m=f.getParameter("filterItems").map(r=>new F(r.getParent().getKey(),"EQ",r.getKey()));w.getBinding("items").filter(m),T()}}).open()}})]}),columns:[new i({width:"12em",headerMenu:"columnHeaderMenu",header:new t({text:"Nom"}),minScreenWidth:"Tablet",demandPopin:!0}),new i({width:"6em",header:new t({text:"Type"}),minScreenWidth:"Tablet",demandPopin:!0}),new i({width:"12em",header:new t({text:"Statut"}),minScreenWidth:"Tablet",demandPopin:!0}),new i({width:"12em",header:new t({text:"Adresse"}),minScreenWidth:"Tablet",demandPopin:!0}),new i({width:"6em",header:new t({text:"Code Postal"}),minScreenWidth:"Tablet",demandPopin:!0}),new i({width:"10em",header:new t({text:"Commune"}),minScreenWidth:"Tablet",demandPopin:!0}),new i({width:"6em",header:new t({text:"Lits Obs"}),hAlign:"End",minScreenWidth:"Tablet",demandPopin:!0}),new i({width:"6em",header:new t({text:"Salle Travail"}),hAlign:"Center",minScreenWidth:"Tablet",demandPopin:!0}),new i({width:"6em",header:new t({text:"Acc tot"}),hAlign:"End",minScreenWidth:"Tablet",demandPopin:!0})],items:{path:"/maternites",template:new O({cells:[new N({title:"{nom_mat}"}),new W({number:"{type}",state:"{typeState}",active:!0,press:K,inverted:!1}),new t({text:"{statut}"}),new t({text:"{adresse}"}),new t({text:"{cpo}"}),new t({text:"{nomcom}"}),new t({text:"{lit_obs}"}),new t({text:"{saltrav}"}),new t({text:"{acctot}"})]})}});w.setModel(I),P.addStyleClass("sapUiSmallMarginBegin sapUiSmallMarginEnd sapUiMediumMarginTop"),l.addStyleClass("sapUiSmallMarginBegin sapUiSmallMarginEnd"),C.addStyleClass("sapUiSmallMarginBegin");const z=new p({showHeader:!1,backgroundDesign:"Transparent",titleAlignment:"Center",content:[new sap.m.VBox({items:[new sap.m.HBox({items:[P,l,H],alignItems:"Center",justifyContent:"Start"}),C,w],width:"100%"})]});new v({autoFocus:!1,pages:[z]}).placeAt("content"),setTimeout(function(){var a=l.getDomRef();a?l.focus():console.warn("Input DOM not ready.")},0)})}window.onUI5Init=X;const c=document.createElement("script");c.id="sap-ui-bootstrap";c.src="https://sdk.openui5.org/resources/sap-ui-core.js";c.setAttribute("data-sap-ui-libs","sap.m");c.setAttribute("data-sap-ui-theme","sap_horizon");c.setAttribute("data-sap-ui-async","true");c.setAttribute("data-sap-ui-onInit","onUI5Init");document.head.appendChild(c);
